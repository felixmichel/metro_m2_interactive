<metro-app>
    <div class="container">
        <svg id="map_background"></svg>
    </div>

    <div class="intro">Intro-Text</div>

    <metro-barchart series="age"></metro-barchart>

    <metro-barchart series="revenue"></metro-barchart>

    <script type="text/javascript">
        import { select } from "d3-selection";
        import { transition } from "d3-transition";

        // TODO: make it correctly using enter, append, merge and selections

        var primary_color = "#FF3814";
        var background_color = "#EDE6DE";

        this.on("mount", () => {
            console.log(window.location.href)
            drawBackground();
        })

        function drawBackground () {

            var svg_width = Math.max(0, window.innerWidth);
            var svg_height = Math.max(720, window.innerHeight);
            
            var svg = select("#map_background")

            //svg.selectAll("*").remove();

            svg.attr("width", svg_width)
                .attr("height", svg_height)
                .style("background-color", "#A0BEC9");

            var marseille_shape = svg.append("g")
                .attr("transform", window.innerWidth > 520 ? "translate(-150, -300)" : "translate(-875, -300)")
                .attr("fill", background_color)
                .append("polygon")
                .attr("points", "1692.40315 458.874539 1672.82957 485.321289 1682.61788 494.612613 1689.65328 515.52062 1699.93433 546.074095 1663.79398 578.235484 1644.22039 620.405643 1613.35308 615.403655 1605.82291 650.424281 1574.9556 641.131999 1565.1683 714.036325 1618.62005 775.503701 1648.73566 910.589973 1685.62671 934.175567 1681.86213 962.051456 1601.3036 962.051456 1585.49359 1015.65665 1644.97008 1088.5581 1611.09191 1189.33543 1585.49359 1179.32858 1579.47087 1184.33153 1579.47087 1197.91315 1564.41458 1197.91315 1551.6134 1179.32858 1551.6134 1172.18097 1519.99236 1168.60812 1491.38318 1160.03041 1443.95112 1155.74203 1391.24905 1129.29816 1358.12258 1129.29816 1315.96053 1129.29816 1285.84491 1112.85826 1304.66679 1160.03041 1318.97138 1168.60812 1337.04156 1175.75669 1337.04156 1181.83197 1315.96053 1179.32858 1304.66679 1172.18097 1282.83507 1165.74792 1267.02303 1157.88574 1250.46031 1157.88574 1221.84911 1138.94725 1176.67519 1138.94725 1182.69993 1157.88574 1163.12432 1155.74203 1072.77951 1117.14951 983.933048 1140.01862 965.863883 1140.01862 930.478266 1150.74004 913.160804 1165.74792 904.126221 1165.74792 889.821634 1161.46051 877.776197 1145.38029 862.718897 1150.74004 850.670429 1150.74004 834.106691 1140.01862 809.262094 1135.7312 800.980225 1131.44187 775.381904 1130.7273 775.381904 1120.71949 788.181064 1114.28644 800.980225 1120.71949 796.463944 1072.83181 809.262094 1042.81509 809.262094 1022.80043 826.579556 1008.50616 856.695168 999.214832 883.798916 918.44928 896.973928 912.017194 918.430809 924.882325 941.771999 899.153023 945.537588 836.970118 924.455548 788.367873 869.493318 764.780361 869.493318 746.913243 818.299707 701.884805 805.499537 706.887752 793.4541 698.310998 782.91207 698.310998 782.91207 683.302158 797.216657 676.869113 797.216657 664.718552 813.780395 646.849515 822.816999 643.990277 825.826842 635.056718 819.805134 626.123159 819.805134 608.254122 825.826842 603.252135 851.426173 612.147328 863.47262 612.147328 875.516036 621.834782 916.173679 608.254122 912.784952 597.531741 865.731771 601.820118 838.627013 582.522901 865.731771 568.226713 869.495339 505.331157 750.536297 338.087333 649.64844 256.60913 654.919456 236.595425 576.616035 190.134971 520.905133 210.150594 501.329531 200.141823 474.978497 229.44877 444.861874 237.308077 437.331708 190.134971 432.814417 163.692058 435.074578 138.674448 444.861874 121.522858 469.705461 106.513059 439.966711 77.9226005 450.131879 55.7671052 484.764782 42.1874047 499.06937 35.7534005 505.844801 20.0299911 541.230418 31.4650235 549.512287 48.9743775 563.817885 48.9743775 576.616035 66.8453324 615.76724 102.223723 615.76724 121.522858 693.313906 121.522858 720.420685 92.2159114 720.420685 84.5340481 727.198137 84.5340481 743.007141 92.2159114 800.226501 96.5071659 807.754646 84.5340481 803.992089 66.8453324 785.921913 48.9743775 870.245021 0.0162864087 902.619784 20.0299911 907.137075 31.4650235 910.401528 52.5385933 894.337915 63.6283303 915.418944 80.7837565 894.337915 106.513059 985.438475 102.223723 1003.50663 106.868905 998.991359 96.5033293 1013.29595 87.9256162 1035.8824 100.075218 1062.98514 75.0595261 1090.84261 82.2061816 1528.54298 78.8059812")

            var subway_line = svg.append("g")
                .attr("transform", window.innerWidth > 520 ? "translate(-150, -300)" : "translate(-875, -300)")
                .attr("fill", background_color)
                .attr("stroke", primary_color)
                .attr("stroke-width", 8)
                .append("path")
                .style("display", "block")
                .attr("d", "M921.587842,334.25066 C922.535553,339.359114 923.206428,344.729416 924.571416,349.44078 C926.035419,354.495521 928.69669,359.738256 930.161703,363.465528 C931.625705,367.1928 932.757302,368.267052 933.356441,371.804412 C933.955581,375.341771 934.154621,380.712074 933.755531,384.692562 C933.356441,388.673051 931.773217,392.489524 930.960893,395.685425 C930.147558,398.881325 933.493849,406.621697 934.901272,412.790975 C936.308695,418.961212 941.674683,433.211361 941.342277,441.171379 C941.00886,449.131397 935.503443,450.321707 930.960893,452.163282 C926.351659,454.032673 917.052364,458.480269 910.996304,461.639722 C904.940244,464.799175 898.152688,468.84105 894.625543,471.115203 C891.098399,473.389357 885.641479,479.138526 884.643249,481.728241 C883.64502,484.318916 883.511653,487.792971 883.84507,490.825815 C884.177476,493.857701 884.909982,496.195159 886.639708,499.922431 C888.369433,503.649703 892.495718,510.345556 894.226454,513.189447 C895.956179,516.032379 900.149147,522.033805 902.611379,523.801526 C905.074621,525.571164 908.001616,526.3922 911.794483,527.592102 C915.587351,528.792962 929.230157,532.520234 931.759072,532.520234 C934.287987,532.520234 938.080855,531.382678 940.543087,531.003812 C943.005319,530.624946 951.922701,525.633509 954.518299,523.423619 C957.112887,521.21181 959.708486,518.368878 962.104035,516.979064 C964.500593,515.58925 965.896902,515.336993 968.891591,515.083776 C971.886279,514.830559 975.37604,515.039655 978.304045,515.798346 C981.23205,516.556077 983.735707,518.701704 985.399759,520.470384 C987.062801,522.240023 987.595258,524.387569 988.993587,526.914939 C990.391917,529.442309 992.520732,532.537499 993.784684,535.632689 C995.048637,538.729796 995.847827,541.694541 996.580333,545.486076 C997.31284,549.274734 998.705107,552.73632 999.237563,557.534967 C999.77002,562.336491 999.784165,568.465485 1000.83493,573.455003 C1001.8857,578.444522 1002.56466,587.543055 1004.82785,592.408843 C1007.09003,597.270794 1011.88113,597.655414 1014.41004,602.645892 C1016.93896,607.632533 1019.14759,619.352434 1020.00033,622.355545 C1020.85206,625.360574 1019.46787,627.850538 1019.60124,633.725355 C1019.73461,639.600172 1020.53279,650.090438 1020.79952,657.60445 C1021.06524,665.122298 1019.20215,682.621101 1025.59062,698.920962 C1031.97908,715.216027 1051.61026,764.559698 1059.92951,785.722469 C1068.24775,806.883322 1072.37403,818.13036 1075.50209,825.902384 C1078.63014,833.673448 1087.08074,839.295049 1089.87639,843.717708 C1092.67103,848.13653 1093.65208,854.571493 1095.46567,858.880971 C1097.27925,863.183736 1098.85945,872.399286 1102.65332,875.937605 C1106.4472,879.474964 1114.23198,880.169392 1118.22591,880.106087 C1122.21781,880.04662 1122.35118,877.264114 1126.61083,875.55778 C1130.86947,873.8572 1138.98766,872.46259 1143.78078,869.871916 C1148.57188,867.283159 1150.90074,863.050413 1155.35842,860.020446 C1159.81813,856.987602 1165.47408,854.460231 1170.53192,851.680603")

            var totalLength = subway_line.node().getTotalLength();

            subway_line
                .attr("stroke-dasharray", totalLength + " " + totalLength)
                .attr("stroke-dashoffset", totalLength)
                .transition()
                .duration(2000)
                .attr("stroke-dashoffset", 0);

            subway_line.exit().remove()
        }

        // Redraw based on the new size whenever the browser window is resized.
        window.onresize = function () { drawBackground(); riot.update(); };

    </script>
</metro-app>
